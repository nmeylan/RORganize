(function(e){var t;var n;var r=function(t,n){return{width:t-e(window).width()-e(window).scrollLeft(),height:n-e(window).height()-e(window).scrollTop()}};var i=function(r){if(n[t.activeId].currentHover){var i=r?n[t.activeId].currentHover.nextAll(":not(."+n[t.activeId].separatorClass+"):visible:first"):n[t.activeId].currentHover.prevAll(":not(."+n[t.activeId].separatorClass+"):visible:first");if(i.length==0){i=n[t.activeId].currentHover.parent().find("> li:visible");i=r?e(i[0]):e(i[i.length-1])}i.mouseover()}else{var s=e("#"+t.activeId+", #"+t.activeId+" ul").filter(function(){return e(this).is(":visible")&&e(this).parents(":hidden").length==0});if(s.length>0){var o=e(s[s.length-1]).find("> li:visible");e(o[r?0:o.length-1]).mouseover()}}};var s=function(){for(cm in n){e(n[cm].allContext).removeClass(t.activeClass)}};var o=function(){if(t.activeId)e("#"+t.activeId).add("#"+t.activeId+" ul").hide();clearInterval(t.keyUpDown);t.keyUpDownStop=false;if(n[t.activeId])n[t.activeId].currentHover=null;t.activeId=null;e(document).unbind(".jeegoocontext");e(window).unbind("resize.jeegoocontext")};var u=function(r){if(t.activeId&&n[t.activeId].onHide){if(n[t.activeId].onHide.apply(e("#"+t.activeId),[r,n[t.activeId].context])==false){return false}}if(r.which!=3){s();o()}};e.fn.jeegoocontext=function(a,f){if(!t)t={};if(!n)n={};if(f&&f.menuClass)t.menuClass=f.menuClass;if(!t.menuClass)t.menuClass="jeegoocontext";if(f&&f.activeClass)t.activeClass=f.activeClass;if(!t.activeClass)t.activeClass="active";n[a]=e.extend({hoverClass:"hover",submenuClass:"submenu",separatorClass:"separator",operaEvent:"ctrl+click",wrapper:"body",fadeIn:200,delay:300,keyDelay:100,widthOverflowOffset:0,heightOverflowOffset:0,submenuLeftOffset:0,submenuTopOffset:0,autoAddSubmenuArrows:true,startLeftOffset:0,startTopOffset:0,keyboard:true},f||{});n[a].allContext=this.selector;e("#"+a).delegate("li","mouseover.jeegoocontext",function(t){var i=n[a].currentHover=e(this);clearTimeout(n[a].show);clearTimeout(n[a].hide);e("#"+a).find("*").removeClass(n[a].hoverClass);var s=i.parents("li");i.add(i.find("> *")).add(s).add(s.find("> *")).addClass(n[a].hoverClass);var o=true;if(n[a].onHover){if(n[a].onHover.apply(this,[t,n[a].context])==false)o=false}if(!n[a].proceed){n[a].show=setTimeout(function(){n[a].proceed=true;i.mouseover()},n[a].delay);return false}n[a].proceed=false;i.parent().find("ul").not(i.find("> ul")).hide();if(!o){t.preventDefault();return false}var u=i.find("> ul");if(u.length!=0){var f=i.offset();var l=r(f.left+i.parent().width()+n[a].submenuLeftOffset+u.width()+n[a].widthOverflowOffset,f.top+n[a].submenuTopOffset+u.height()+n[a].heightOverflowOffset);var c=u.parent().parent().width();var h=f.top-i.parent().offset().top;u.css({left:l.width>0&&!n[a].ignoreWidthOverflow?-c-n[a].submenuLeftOffset+"px":c+n[a].submenuLeftOffset+"px",top:l.height>0&&!n[a].ignoreHeightOverflow?h-l.height+n[a].submenuTopOffset+"px":h+n[a].submenuTopOffset+"px"});u.fadeIn(n[a].fadeIn)}t.stopPropagation()}).delegate("li","click.jeegoocontext",function(r){if(n[a].onSelect){if(n[a].onSelect.apply(this,[r,n[a].context])==false){return false}}o();e(n[a].context).removeClass(t.activeClass);r.stopPropagation()});var l=document.createElement("div");l.setAttribute("oncontextmenu","");var c=n[a].event;if(!c){c=typeof l.oncontextmenu!="undefined"?"contextmenu.jeegoocontext":n[a].operaEvent+".jeegoocontext"}else{c+=".jeegoocontext"}if(c.indexOf("+")!=-1){var h=c.split("+",2);n[a].modifier=h[0]+"Key";c=h[1]}return e(n[a].wrapper).delegate(n[a].allContext,c,function(f){if(typeof n[a].modifier=="string"&&!f[n[a].modifier])return;n[a].context=this;var l=e("#"+a);var c,h;if(n[a].openBelowContext){var p=e(this).offset();c=p.left;h=p.top+e(this).outerHeight()}else{c=f.pageX;h=f.pageY}c+=n[a].startLeftOffset;h+=n[a].startTopOffset;var d=r(c+l.width()+n[a].widthOverflowOffset,h+l.height()+n[a].heightOverflowOffset);if(!n[a].ignoreWidthOverflow&&d.width>0)c-=d.width;if(!n[a].openBelowContext&&!n[a].ignoreHeightOverflow&&d.height>0){h-=d.height}if(n[a].onShow){if(n[a].onShow.apply(l,[f,n[a].context,c,h])==false){return false}}o();t.activeId=a;e("#"+t.activeId).add("#"+t.activeId+" ul").hide();s();e(n[a].context).addClass(t.activeClass);l.find("li, li > *").removeClass(n[a].hoverClass);if(n[a].autoAddSubmenuArrows){l.find("li:has(ul)").not(":has(span."+n[a].submenuClass+")").prepend('<span class="'+n[a].submenuClass+'"></span>');l.find("li").not(":has(ul)").find("> span."+n[a].submenuClass).remove()}l.css({left:c+"px",top:h+"px"}).fadeIn(n[a].fadeIn);if(n[a].openBelowContext){e(window).bind("resize.jeegoocontext",function(){e("#"+a).css("left",e(n[a].context).offset().left+n[a].startLeftOffset+"px")})}e(document).bind("mouseover.jeegoocontext",function(r){if(e(r.relatedTarget).parents("#"+a).length>0){clearTimeout(n[a].show);var i=e(r.relatedTarget).parent().find("li");i.add(i.find("> *")).removeClass(n[a].hoverClass);n[t.activeId].currentHover=null;n[a].hide=setTimeout(function(){i.find("ul").hide();if(n[a].autoHide)u(r)},n[a].delay)}}).bind("click.jeegoocontext",u);if(n[a].keyboard){e(document).bind("keydown.jeegoocontext",function(r){switch(r.which){case 38:if(t.keyUpDownStop)return false;i();t.keyUpDown=setInterval(i,n[t.activeId].keyDelay);t.keyUpDownStop=true;return false;case 39:if(n[t.activeId].currentHover){n[t.activeId].currentHover.find("ul:visible:first li:visible:first").mouseover()}else{var s=e("#"+t.activeId+", #"+t.activeId+" ul:visible");if(s.length>0){e(s[s.length-1]).find(":visible:first").mouseover()}}return false;case 40:if(t.keyUpDownStop)return false;i(true);t.keyUpDown=setInterval(function(){i(true)},n[t.activeId].keyDelay);t.keyUpDownStop=true;return false;case 37:if(n[t.activeId].currentHover){e(n[t.activeId].currentHover.parents("li")[0]).mouseover()}else{var o=e("#"+t.activeId+" li."+n[t.activeId].hoverClass);if(o.length>0)e(o[o.length-1]).mouseover()}return false;case 13:if(n[t.activeId].currentHover){n[t.activeId].currentHover.click()}else{u(r)}break;case 27:u(r);break;default:break}}).bind("keyup.jeegoocontext",function(e){clearInterval(t.keyUpDown);t.keyUpDownStop=false})}return false})}})(jQuery)