<%#
# Author: Nicolas Meylan
# Date: 27 aoÃ»t 2012
# Encoding: UTF-8
# File: _toolbox.html.erb
%>
<%= form_tag({},:remote => true) do -%>
  <% ids = @documents_toolbox.collect{|document| document.id} %>
  <% if current_user.allowed_to?('edit','Documents',@project) %>
    <li><%= link_to t(:field_version), '#', {:class => 'icon icon-target', :id => 'version'} %>
      <ul class="submenu version_id">
        <% if !@versions.nil? && @versions.any? %>
          <%= hidden_field_tag 'value[version_id]' %>
          <% @versions.each do |version| %>
            <li><%= link_to version, '#', {:class => @actual_states['version'].include?(version) ? 'icon icon-toggle_check' : 'no-icon'} %></li>
          <% end %>
        <%  end %>
      </ul>
    </li>
    <li><%= link_to t(:field_category), '#', {:class => 'icon icon-package'}%>
      <ul class="submenu category_id">
        <% if !@categories.nil? && @categories.any? %>
          <%= hidden_field_tag 'value[category_id]' %>
          <% @categories.each do |category| %>
            <li><%= link_to category, '#', {:class => @actual_states['category'].include?(category) ? 'icon icon-toggle_check' : 'no-icon'} %></li>
          <% end %>
        <%  end %>
      </ul>
    </li>
    <li><%= link_to t(:link_edit), {:action => 'edit', :project_id => @project.identifier, :id => ids[0]}, {:class => 'icon icon-edit'} if @documents_toolbox.size == 1%></li>
  <% end %>
  <% if current_user.allowed_to?('destroy','Documents',@project) %>
    <li><%= link_to t(:link_delete), '#', {:class => 'icon icon-del', :onclick => "jQuery('#delete_overlay').overlay().load();"}%></li>
  <% end %>
  <% ids.each do |id| %>
    <%= hidden_field_tag 'ids[]', id %>
  <% end %>
<% end -%>

<script type="text/javascript">
  createOverlay("#delete_overlay", 150);
  jQuery(".submenu a").click(function(e) {
    e.preventDefault();
    // find the context of the selected options: e.g: "category" for update categories of the selected documents
    var context = _.without(jQuery(this).parents(".submenu").attr('class').split(' '), 'submenu', 'hover');
    //put new value into hidden field which name is matching with context
    jQuery("input#value_" + context).val(jQuery(this).text());
    jQuery('#documents_toolbox form').submit();
  });
</script>