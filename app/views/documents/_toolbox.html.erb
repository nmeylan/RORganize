<%#
# Author: Nicolas Meylan
# Date: 27 aoÃ»t 2012
# Encoding: UTF-8
# File: _toolbox.html.erb
%>
<%= form_tag(toolbox_documents_path(@project.slug),:remote => true, :id => 'toolbox_form') do %>
  <% ids = @documents_toolbox.collect{|document| document.id} %>
  <% if current_user.allowed_to?('edit','Documents',@project) %>
    <li><%= link_to glyph(t(:field_version),'clippy'), '#', {:id => 'version'} %>
      <ul class="submenu version_id">
        <% if !menu['versions'].nil? && menu['versions'].any? %>
          <%= hidden_field_tag 'value[version_id]' %>
          <% menu['versions'].each do |version| %>
            <li><%= link_to conditional_glyph(version.name,menu['current_states']['version'].include?(version),'check'), '#', {:'data-id' => version.id} %></li>
          <% end %>
            <li><%= link_to conditional_glyph('None', menu['current_states']['version'].include?(nil), 'check'), '#', {:'data-id' => -1} %></li>
        <%  end %>
      </ul>
    </li>
    <li><%= link_to glyph(t(:field_category), 'package'), '#'%>
      <ul class="submenu category_id">
        <% if !menu['categories'].nil? && menu['categories'].any? %>
          <%= hidden_field_tag 'value[category_id]' %>
          <% menu['categories'].each do |category| %>
            <li><%= link_to conditional_glyph(category.name, menu['current_states']['category'].include?(category), 'check'), '#', {:'data-id' => category.id} %></li>
          <% end %>
            <li><%= link_to conditional_glyph('None', menu['current_states']['category'].include?(nil), 'check') , '#', {:class => menu['current_states']['category'].include?(nil) ? 'icon icon-toggle_check' : 'no-icon',:'data-id' => -1} %></li>
        <%  end %>
      </ul>
    </li>
    <li><%= link_to glyph(t(:link_edit), 'pencil'), {:action => 'edit', :project_id => @project.slug, :id => ids[0]}, {} if @documents_toolbox.size == 1%></li>
  <% end %>
  <% if current_user.allowed_to?('destroy','Documents',@project) %>
    <li><%= link_to glyph(t(:link_delete),'trashcan'), '#', {:class => 'icon icon-del', :id=> 'open_delete_overlay'}%></li>
  <% end %>
  <% ids.each do |id| %>
    <%= hidden_field_tag 'ids[]', id %>
  <% end %>
<% end %>
