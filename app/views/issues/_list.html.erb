<%#
# Author: Nicolas Meylan
# Date: 14 juil. 2012
# Encoding: UTF-8
# File: _list.html.erb
%>
<div id="issues_content">
  <% if @issues.any?  %>
    <table class="issue list">
      <tr class="header">
        <th><%= link_to '', '#', {:class => 'icon icon-checked', :id => 'check_all', 'cb_checked' => "b"} %></th>
        <th><%= sortable 'issues.id', '#'%></th>
        <th><%= sortable 'trackers.name', 'Tracker'%></th>
        <th><%= sortable 'issues.subject', 'Subject' %></th>
        <th><%= sortable 'users.name', 'Assigned to' %></th>
        <th><%= sortable 'issues_statuses.enumeration_id', 'Status' %></th>
        <th><%= sortable 'categories.name', 'Category' %></th>
        <th><%= sortable 'versions.name', 'Target phase' %></th>
        <th><%= sortable 'issues.due_date', 'Due date' %></th>
        <th><%= sortable 'issues.done', 'Done' %></th>
        <th></th>
        <th></th>
      </tr>
      <% @issues.each do |issue| %>
        <tr class="odd_even issue_tr<%=" close" if issue.status.is_closed? %>">
          <td><%= check_box_tag 'issue-'+issue.id.to_s, issue.id %></td>
          <td class="list_center id"><%= issue.id %></td>
          <td class="list_center tracker"><%= issue.tracker ? issue.tracker.name : '-' %></td>
          <td class="subject"><%= link_to issue.subject, {:action => 'show', :controller => 'issues', :id => issue.id}, {:id => issue.id} %></td>
          <td class="list_center assigned_to"><%= issue.assigned_to ? issue.assigned_to.name : '-' %></td>
          <td class="list_center status"><%= issue.status ? issue.status.enumeration.name : '-' %></td>
          <td class="list_center category"><%= issue.category ? issue.category.name : '-' %></td>
          <td class="list_center version"><%= issue.version ? issue.version.name : '-' %></td>
          <td class="list_center due_date"><%= issue.due_date ? issue.due_date : '-' %></td>
          <td class="list_center done"><%= issue.done ? issue.done.to_s+'%' : '-' %></td>
          <td><%= link_to '', '#', {:class => 'icon icon-checklist', :id => issue.id} if issue.checklist_items.size > 0 %></td>
          <td><%= issue.attachments.empty? ? "" : image_tag('/assets/attachment.png')%></td>
        </tr>
      <%end%>
    </table>
    <%= will_paginate(@issues, :renderer => 'RemoteLinkRenderer')%>
    <div class="autocomplete-combobox nosearch per_page">
      <label for="per_page"><%=t(:label_per_page)%></label>
      <%= select_tag 'per_page', options_for_select([['25','25'],['50','50'],['100','100']], session[:controller_issues_per_page]),:class => 'chzn-select cbb-small', :id => 'per_page'%>
    </div>
    <ul id="issues_toolbox" class="jeegoocontext box toolbox">
      <% if @issues_toolbox %>
        <%= render :partial => 'issues/toolbox' %>
      <% end %>
    </ul>
  <% else %>
    <h2><%= t(:text_no_data) %></h2>
  <% end %>
</div>
<%# OVERLAY renderer %>
<%= render :partial => 'issues/delete_overlay', :locals => {:issues => @issues_toolbox} %>
<%= render :partial => 'queries/create_overlay'%>
<div class="overlayOuter" id="checklist_overlay">
  <div class="overlayInner">
    <ul class="checklist" id="items">
      <%= render :partial => 'issues/show_checklist' if @checklist_items%>
    </ul>
  </div>
</div>
<div class="tooltip" id="tooltip" style="">
  <%= render :partial => 'issues/tooltip', :locals => {:description => nil} %>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      createOverlay("#checklist_overlay", 150);
      createOverlay("#create_query_overlay", 150);
      init_tooltip(".subject a", "<%=url_for(:action => 'issue_description', :project_id => @project.slug)%>");
      $(".chzn-select").chosen();
    });
    show_checklist_overlay("<%=url_for(:action => 'show_checklist_items', :controller => 'issues', :project_id => @project.slug)%>");
    per_page("<%=url_for(:action => 'index', :controller => 'issues', :project_id => @project.slug)%>");
    checkAll("#check_all", ".list");
    listTrClick(".list .issue_tr");
    checkboxToolbox(".list");
    init_toolbox('.issue.list .issue_tr', 'issues_toolbox', {list: '.issue.list', url: "<%= url_for(:controller => 'issues', :action => 'toolbox', :project_id => @project.slug) %>"});
  })(jQuery);

</script>