<%#
# Author: Nicolas Meylan
# Date: 14 juil. 2012
# Encoding: UTF-8
# File: _list.html.erb
%>
<div id="issues_content" >
  <% if @issues.any?  %>
    <table class="issue list" data-link="<%= toolbox_issues_path(@project.slug) %>">
      <tr class="header">
        <th><%= link_to glyph('','check'), '#', {:id => 'check_all', 'cb_checked' => 'b'} %></th>
        <th><%= sortable 'issues.id', '#'%></th>
        <th><%= sortable 'trackers.name', 'Tracker'%></th>
        <th><%= sortable 'issues.subject', 'Subject' %></th>
        <th><%= sortable 'users.name', 'Assigned to' %></th>
        <th><%= sortable 'issues_statuses.enumeration_id', 'Status' %></th>
        <th><%= sortable 'categories.name', 'Category' %></th>
        <th><%= sortable 'versions.name', 'Target phase' %></th>
        <th><%= sortable 'issues.due_date', 'Due date' %></th>
        <th><%= sortable 'issues.done', 'Done' %></th>
        <th></th>
        <th></th>
      </tr>
      <% @issues.each do |issue| %>
        <tr class="odd_even issue_tr<%= ' close' if issue.status.is_closed? %>">
          <td><%= check_box_tag 'issue-'+issue.id.to_s, issue.id %></td>
          <td class="list_center id"><%= issue.id %></td>
          <td class="list_center tracker"><%= issue.tracker ? issue.tracker.name : '-' %></td>
          <td class="subject"><%= link_to issue.subject, issue_path(@project.slug, issue.id), {:id => issue.id} %></td>
          <td class="list_center assigned_to"><%= issue.assigned_to ? issue.assigned_to.name : '-' %></td>
          <td class="list_center status"><%= issue.status ? issue.status.enumeration.name : '-' %></td>
          <td class="list_center category"><%= issue.category ? issue.category.name : '-' %></td>
          <td class="list_center version"><%= issue.version ? issue.version.name : '-' %></td>
          <td class="list_center due_date"><%= issue.due_date ? issue.due_date : '-' %></td>
          <td class="list_center done"><%= issue.done ? issue.done.to_s+'%' : '-' %></td>
          <td><%= link_to glyph('','checklist'),show_checklist_items_issues_path(@project.slug, issue.id) , {:remote => true} if issue.checklist_items.size > 0 %></td>
          <td><%= content_tag :span, nil, {class: 'octicon octicon-attachment'} unless issue.attachments.empty? %></td>
        </tr>
      <%end%>
    </table>
    <%= will_paginate(@issues, :renderer => 'RemoteLinkRenderer')%>
    <div class="autocomplete-combobox nosearch per_page">
      <label for="per_page"><%=t(:label_per_page)%></label>
      <%= select_tag 'per_page', options_for_select([%w(25 25), %w(50 50), %w(100 100)], session[:controller_issues_per_page]),:class => 'chzn-select cbb-small', :id => 'per_page','data-link' => issues_path(@project.slug)%>
    </div>
    <ul id="issues_toolbox" class="jeegoocontext box toolbox">
      <% if @issues_toolbox %>
        <%= render :partial => 'issues/toolbox' %>
      <% end %>
    </ul>
  <% else %>
    <h2><%= t(:text_no_data) %></h2>
  <% end %>
</div>
<%# OVERLAY renderer %>
<%= render :partial => 'issues/delete_overlay', :locals => {:issues => @issues_toolbox} %>
<%= render :partial => 'queries/create_overlay'%>
<%= render :partial => 'issues/show_checklist', :locals => {:checklist_items => nil}%>
